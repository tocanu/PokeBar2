<Window x:Class="Pokebar.Editor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Pokebar Editor (preview stub)" Height="650" Width="1200">
    <DockPanel>
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="8">
            <TextBlock Text="Raw dir:" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding RawPath}" Margin="6,0,0,0" VerticalAlignment="Center" FontWeight="Bold"/>
            <Button Content="Recarregar" Margin="12,0,0,0" Padding="10,4" Click="Reload_Click"/>
            <Button Content="Salvar Atual" Margin="12,0,0,0" Padding="10,4" Click="SaveCurrent_Click"/>
            <Button Content="Exportar Final" Margin="8,0,0,0" Padding="10,4" Click="ExportAll_Click"/>
            <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>
        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>
            <DataGrid ItemsSource="{Binding Entries}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      Margin="0,0,8,0"
                      RowHeight="28"
                      SelectionChanged="DataGrid_SelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Dex" Binding="{Binding DexNumber}" Width="60"/>
                    <DataGridTextColumn Header="Species" Binding="{Binding Species}" Width="90"/>
                    <DataGridTextColumn Header="Walk" Binding="{Binding HasWalk}" Width="60"/>
                    <DataGridTextColumn Header="Idle" Binding="{Binding HasIdle}" Width="60"/>
                    <DataGridTextColumn Header="Sleep" Binding="{Binding HasSleep}" Width="60"/>
                    <DataGridTextColumn Header="Emotes" Binding="{Binding EmoteCount}" Width="70"/>
                    <DataGridTextColumn Header="Frame" Binding="{Binding FrameSize}" Width="100"/>
                    <DataGridTextColumn Header="Grid" Binding="{Binding Grid}" Width="90"/>
                    <DataGridTextColumn Header="GroundY" Binding="{Binding GroundOffsetY}" Width="80"/>
                    <DataGridTextColumn Header="CenterX" Binding="{Binding CenterOffsetX}" Width="80"/>
                    <DataGridTextColumn Header="BodyType" Binding="{Binding BodyType}" Width="90"/>
                    <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
            <Border Grid.Column="1" Padding="10" BorderBrush="Gray" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Vertical" Margin="0,0,0,8">
                        <TextBlock Text="{Binding SelectedEntryText}" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="{Binding SelectedSpritePath}" FontSize="12" Foreground="Gray"/>
                    </StackPanel>
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Background="#222">
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                                <Canvas>
                                    <Image x:Name="PreviewImageElement"
                                           Source="{Binding PreviewImage}"
                                           Stretch="None"
                                           RenderTransformOrigin="0.5,0.5">
                                        <Image.RenderTransform>
                                            <TranslateTransform X="{Binding SelectedCenterOffset, Converter={StaticResource NegateConverter}}" />
                                        </Image.RenderTransform>
                                    </Image>
                                    <Rectangle Stroke="Lime"
                                               StrokeThickness="2"
                                               Canvas.Left="{Binding HitboxX}"
                                               Canvas.Top="{Binding HitboxY}"
                                               Width="{Binding HitboxWidth}"
                                               Height="{Binding HitboxHeight}"
                                               StrokeDashArray="3 2"
                                               Opacity="0.9"/>
                                    <Rectangle Fill="Red"
                                               Height="2"
                                               Opacity="0.6"
                                               Canvas.Top="{Binding GroundLineY}"
                                               Width="{Binding ElementName=PreviewImageElement, Path=ActualWidth}"/>
                                </Canvas>
                            </ScrollViewer>
                        </Border>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="GroundY:"/>
                            <TextBlock Text="{Binding SelectedGroundOffset}" Margin="4,0,12,0"/>
                            <TextBlock Text="CenterX:"/>
                            <TextBlock Text="{Binding SelectedCenterOffset}" Margin="4,0,12,0"/>
                            <TextBlock Text="Linha:" Margin="12,0,4,0"/>
                            <ComboBox Width="140"
                                      SelectedIndex="{Binding SelectedStripIndex, Mode=TwoWay}">
                                <ComboBoxItem Content="Strip 1 (linha 3)"/>
                                <ComboBoxItem Content="Strip 2 (linha 7)"/>
                            </ComboBox>
                            <CheckBox Content="Revisado" Margin="12,0,0,0" IsChecked="{Binding SelectedReviewed, Mode=TwoWay}"/>
                        </StackPanel>
                    </Grid>
                    <StackPanel Grid.Row="2" Orientation="Vertical" Margin="0,12,0,0">
                        <TextBlock Text="Ajuste Ground Offset (preview local)" />
                        <Slider Minimum="0"
                                Maximum="{Binding SelectedFrameHeight, FallbackValue=200}"
                                Value="{Binding SelectedGroundOffset, Mode=TwoWay}"
                                ValueChanged="GroundSlider_ValueChanged"
                                TickFrequency="2"
                                IsSnapToTickEnabled="False"/>
                        <TextBlock Text="Ajuste Center Offset (preview local)" Margin="0,8,0,0"/>
                        <Slider Minimum="-200"
                                Maximum="200"
                                Value="{Binding SelectedCenterOffset, Mode=TwoWay}"
                                ValueChanged="CenterSlider_ValueChanged"
                                TickFrequency="2"
                                IsSnapToTickEnabled="False"/>
                        <TextBlock Text="Hitbox Width" Margin="0,12,0,0"/>
                        <Slider Minimum="1"
                                Maximum="400"
                                Value="{Binding HitboxWidth, Mode=TwoWay}"
                                ValueChanged="HitboxSlider_ValueChanged"
                                TickFrequency="4"
                                IsSnapToTickEnabled="False"/>
                        <TextBlock Text="Hitbox Height" Margin="0,8,0,0"/>
                        <Slider Minimum="1"
                                Maximum="400"
                                Value="{Binding HitboxHeight, Mode=TwoWay}"
                                ValueChanged="HitboxSlider_ValueChanged"
                                TickFrequency="4"
                                IsSnapToTickEnabled="False"/>
                        <TextBlock Text="Hitbox X" Margin="0,8,0,0"/>
                        <Slider Minimum="-200"
                                Maximum="400"
                                Value="{Binding HitboxX, Mode=TwoWay}"
                                ValueChanged="HitboxSlider_ValueChanged"
                                TickFrequency="2"
                                IsSnapToTickEnabled="False"/>
                        <TextBlock Text="Hitbox Y" Margin="0,8,0,0"/>
                        <Slider Minimum="-200"
                                Maximum="400"
                                Value="{Binding HitboxY, Mode=TwoWay}"
                                ValueChanged="HitboxSlider_ValueChanged"
                                TickFrequency="2"
                                IsSnapToTickEnabled="False"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
